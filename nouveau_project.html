<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mailix | Créer un Nouveau Projet</title>
    <link rel="icon" type="image/png" href="https://i.imgur.com/7Gn3toV.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
    <style>
        /* Configuration de la police Inter et réutilisation des styles du Dashboard */
        body { font-family: 'Inter', sans-serif; }
        
        /* Transition pour un effet doux des couleurs */
        .transition-colors-theme { transition: background-color 0.3s, color 0.3s, border-color 0.3s; }
        
        /* Style et positionnement du bouton de Thème */
        .theme-switch {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 24px;
            transition: color 0.2s;
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 60;
        }
        
        /* Définir les Variables de Thème (RÉUTILISATION) */
        :root, .dark {
            --bg-page: #121212; 
            --bg-card: #1E1E1E; 
            --bg-sidebar: #1E1E1E;
            --bg-sidebar-active: #2C2C2C;
            --border-sidebar: #383838;
            --text-color: #FFFFFF;
            --text-secondary: #D1D5DB;
            --text-link: #3B82F6; 
            --text-link-hover: #60A5FA;
            --input-bg: #2C2C2C; 
            --input-border: #4B5563;
            --input-text-key: #6EE7B7;
            --primary-color: #3B82F6; 
            --primary-hover: #2563EB; 
        }
        .light {
            --bg-page: #F5F5F5; 
            --bg-card: #FFFFFF; 
            --bg-sidebar: #FFFFFF; 
            --bg-sidebar-active: #F3F4F6;
            --border-sidebar: #D1D5DB;
            --text-color: #000000;
            --text-secondary: #4B5563;
            --text-link: #1D4ED8;
            --text-link-hover: #3B82F6;
            --input-bg: #FFFFFF;
            --input-border: #D1D5DB;
            --input-text-key: #059669;
            --primary-color: #3B82F6;
            --primary-hover: #2563EB;
        }

        /* Appliquer les variables au body et aux éléments */
        .bg-page-var { background-color: var(--bg-page); }
        .bg-card-var { background-color: var(--bg-card); }
        .bg-sidebar-var { background-color: var(--bg-sidebar); }
        .border-sidebar-var { border-color: var(--border-sidebar); }
        .text-color-var { color: var(--text-color); }
        .text-secondary-var { color: var(--text-secondary); }
        .text-link-var { color: var(--text-link); }
        .hover\:text-link-hover-var:hover { color: var(--text-link-hover); }
        .bg-input-var { background-color: var(--input-bg); }
        .border-input-var { border-color: var(--input-border); }
        .text-input-key-var { color: var(--input-text-key); }
        .bg-primary-color-var { background-color: var(--primary-color); }
        .hover\:bg-primary-hover-var:hover { background-color: var(--primary-hover); }
        .focus\:ring-primary-color-var:focus { --tw-ring-color: var(--primary-color); }
        .focus\:border-primary-color-var:focus { border-color: var(--primary-color); }
        .bg-sidebar-active-var { background-color: var(--bg-sidebar-active); }

        /* Sidebar Gauche - Fixée et masquée sur mobile */
        .sidebar {
            transition: transform 0.3s ease-in-out;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 30;
            height: 100vh;
            transform: translateX(-100%);
        }

        .sidebar.open {
            transform: translateX(0);
        }

        /* Sur les grands écrans (lg), la sidebar est statique et toujours visible */
        @media (min-width: 1024px) {
            .sidebar {
                transform: translateX(0) !important;
                position: sticky; /* Changer à sticky ou rester fixed si vous voulez la scrollbar du body */
            }
            .main-content {
                margin-left: 256px; /* Décaler le contenu principal de la largeur de la sidebar */
            }
        }
        
    </style>
</head>

<body class="bg-page-var text-color-var min-h-screen transition-colors-theme flex">
    
    <button id="theme-toggle" class="theme-switch text-color-var hover:text-link-hover-var transition-colors-theme">
        <span class="material-symbols-rounded">dark_mode</span>
    </button>
    

    <aside id="sidebar-left" class="sidebar sidebar-left w-64 bg-sidebar-var border-r border-sidebar-var p-6 flex flex-col transition-colors-theme">
    
    <div class="flex items-center mb-6 shrink-0">
        <img src="https://i.imgur.com/7Gn3toV.png" alt="Nexus Pro Logo" class="h-8">
        <span class="text-xl font-bold text-color-var ml-2 transition-colors-theme">Mailix</span>
    </div>
    
    <div class="flex-grow overflow-y-auto pr-2" id="scrollable-nav-container">
        <h3 class="text-xs font-semibold uppercase tracking-wider text-secondary-var mb-2">Fichiers Ouverts</h3>
        <nav id="file-explorer" class="space-y-1 pb-4 border-b border-sidebar-var/50 mb-4">
            </nav>
        
        <h3 class="text-xs font-semibold uppercase tracking-wider text-secondary-var mb-2">Navigation</h3>
        <nav class="space-y-3 pb-4"> 
            <a href="{{ url_for('user_bp.dashboard') }}" class="flex items-center p-3 text-secondary-var hover:text-color-var hover:bg-sidebar-active-var rounded-lg transition duration-150 transition-colors-theme">
                <span class="material-symbols-rounded">dashboard</span>
                <span class="ml-3">Dashboard</span>
            </a>

            <a href="{{ url_for('user_bp.profile') }}" class="flex items-center p-3 text-secondary-var hover:text-color-var hover:bg-sidebar-active-var rounded-lg transition duration-150 transition-colors-theme">
                <span class="material-symbols-rounded">person</span>
                <span class="ml-3">Profil</span>
            </a>
            <a href="/parametres" class="flex items-center p-3 text-secondary-var hover:text-color-var hover:bg-sidebar-active-var rounded-lg transition duration-150 transition-colors-theme">
                <span class="material-symbols-rounded">settings</span> <span class="ml-3">Paramètres</span>
            </a>
            
            <a href="/aide" class="flex items-center p-3 text-secondary-var hover:text-color-var hover:bg-sidebar-active-var rounded-lg transition duration-150 transition-colors-theme">
                <span class="material-symbols-rounded">help</span>
                <span class="ml-3">Aide & Support</span>
            </a>
            <a href="{{ url_for('user_bp.profile') }}" class="flex items-center p-3 text-secondary-var hover:text-color-var hover:bg-sidebar-active-var rounded-lg transition duration-150 transition-colors-theme">
                <span class="material-symbols-rounded">person</span>
                <span class="ml-3">Profil</span>
            </a>

            <a href="/statut" class="flex items-center p-3 bg-sidebar-active-var text-color-var rounded-lg transition duration-150 transition-colors-theme">
                <span class="material-symbols-rounded">monitor_heart</span>
                <span class="ml-3">Statut de l'API</span>
            </a>
            <a href="{{ url_for('user_bp.deconnexion') }}" id="logout-button-sidebar" class="flex items-center p-3 text-red-500 hover:text-red-400 hover:bg-sidebar-active-var rounded-lg transition duration-150 transition-colors-theme">
                <span class="material-symbols-rounded">deconnexion</span>
                <span class="ml-3">Déconnexion</span>
            </a>
        </nav>
    </div>
    
    <div class="mt-auto pt-4 text-xs text-secondary-var transition-colors-theme border-t border-sidebar-var/50 shrink-0">
        <p>Connecté en tant que: <span class="font-semibold text-color-var transition-colors-theme">{{ user.email if user and user.email else 'Chargement...' }}</span></p>
        <p>Plan: <span class="font-semibold text-color-var transition-colors-theme">{{ (user.plan | upper) if user and user.plan else 'GRATUIT' }}</span></p>
    </div>
    
</aside>

    <div id="main-content" class="main-content flex-1 p-8 transition-colors-theme">
        
        <header class="lg:hidden flex justify-between items-center mb-8">
            <button id="sidebar-left-toggle" class="p-2 rounded-lg bg-sidebar-active-var hover:bg-sidebar-active-var/80 transition-colors-theme">
                 <span class="material-symbols-rounded text-color-var">menu</span>
            </button>
            <div class="flex items-center">
                 <img src="https://i.imgur.com/7Gn3toV.png" alt="Nexus Pro Logo" class="h-8">
                <span class="text-xl font-bold text-color-var ml-2 transition-colors-theme">Mailix</span>
            </div>
            <div class="w-8"></div>
        </header>

        <h1 class="text-3xl font-bold mb-2 text-color-var transition-colors-theme">Créer un Nouveau Projet</h1>
        <p class="text-secondary-var mb-8 transition-colors-theme">Configurez les paramètres de base de votre projet avant de passer à l'éditeur.</p>
        
        <div class="max-w-3xl bg-card-var p-8 rounded-lg shadow-xl border border-sidebar-var transition-colors-theme">
            
            <form id="new-project-form" action="/project/editor" method="GET">
                
                <div class="mb-6">
                    <label for="project-name" class="block text-sm font-medium text-color-var mb-2 transition-colors-theme">
                        Nom du Projet <span class="text-red-500">*</span>
                    </label>
                    <input type="text" id="project-name" name="name" required
                           class="w-full p-3 rounded-lg border border-input-border-var bg-input-var text-color-var 
                                  focus:outline-none focus:ring-2 focus:ring-primary-color-var transition-colors-theme"
                           placeholder="Ex: API de Stockage de Données">
                    <p class="text-xs text-secondary-var mt-1">Choisissez un nom descriptif pour votre projet.</p>
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-color-var mb-2 transition-colors-theme">
                        Visibilité
                    </label>
                    
                    <div class="flex items-center space-x-4">
                        <span class="text-secondary-var font-medium flex items-center">
                            <span class="material-symbols-rounded text-lg mr-1">lock</span> Privé
                        </span>
                        
                        <div class="relative inline-block w-12 mr-2 align-middle select-none transition duration-200 ease-in">
                            <input type="checkbox" name="visibility" id="toggle-visibility" value="public" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-input-border-var border-4 appearance-none cursor-pointer" />
                            <label for="toggle-visibility" class="toggle-label block overflow-hidden h-6 rounded-full bg-input-border-var cursor-pointer transition-colors duration-200 ease-in"></label>
                        </div>
                        <span class="text-primary-color-var font-medium flex items-center">
                            <span class="material-symbols-rounded text-lg mr-1">public</span> Public
                        </span>
                    </div>

                    <p class="text-xs text-secondary-var mt-1">
                        <span id="visibility-status-text" class="font-semibold text-color-var transition-colors-theme">Privé</span>
                    </p>
                </div>

                <div class="mb-8">
                    <label for="project-license" class="block text-sm font-medium text-color-var mb-2 transition-colors-theme">
                        Licence
                    </label>
                    <select id="project-license" name="license"
                            class="w-full p-3 rounded-lg border border-input-border-var bg-input-var text-color-var 
                                   focus:outline-none focus:ring-2 focus:ring-primary-color-var appearance-none transition-colors-theme">
                        <option value="none" class="bg-input-var text-color-var transition-colors-theme">Pas de licence (Droit d'auteur standard)</option>
                        <option value="MIT" class="bg-input-var text-color-var transition-colors-theme">MIT License (Très Permissive)</option>
                        <option value="Apache-2.0" class="bg-input-var text-color-var transition-colors-theme">Apache License 2.0</option>
                        <option value="GPL-3.0" class="bg-input-var text-color-var transition-colors-theme">GNU GPL v3.0 (Copyleft)</option>
                        <option value="CC0-1.0" class="bg-input-var text-color-var transition-colors-theme">CC0-1.0 (Domaine Public)</option>
                    </select>
                    <p class="text-xs text-secondary-var mt-1">
                        La licence que vous choisissez sera ajoutée automatiquement à votre projet.
                    </p>
                </div>
                
                <div class="flex justify-end">
                    <button type="submit"
                            class="px-6 py-3 bg-primary-color-var hover:bg-primary-hover-var text-white font-semibold rounded-lg shadow-md 
                                   transition duration-150 flex items-center">
                        Suivant : Configurer l'Éditeur
                        <span class="material-symbols-rounded ml-2">arrow_forward</span>
                    </button>
                </div>
                
            </form>
            
        </div>

    </div>

    <script>
        // --- LOGIQUE GÉNÉRALE (Thème et Sidebar) ---
        
        const themeToggle = document.getElementById('theme-toggle');
        const html = document.documentElement;

        const updateIcon = () => {
            const icon = themeToggle.querySelector('.material-symbols-rounded');
            if (html.classList.contains('light')) {
                icon.textContent = 'light_mode';
            } else {
                icon.textContent = 'dark_mode';
            }
        };

        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'light') {
            html.classList.remove('dark');
            html.classList.add('light');
        } else {
            html.classList.add('dark');
            html.classList.remove('light');
        }
        updateIcon();

        themeToggle.addEventListener('click', () => {
            if (html.classList.contains('dark')) {
                html.classList.remove('dark');
                html.classList.add('light');
                localStorage.setItem('theme', 'light');
            } else {
                html.classList.remove('light');
                html.classList.add('dark');
                localStorage.setItem('theme', 'dark');
            }
            updateIcon();
        });


        // Logique pour la Sidebar Gauche sur mobile
        const sidebarLeftToggle = document.getElementById('sidebar-left-toggle');
        const sidebarLeft = document.getElementById('sidebar-left');
        
        sidebarLeftToggle.addEventListener('click', () => {
            sidebarLeft.classList.toggle('open');
        });
        
        // --- LOGIQUE SPÉCIFIQUE AU FORMULAIRE ---
        
        // Logique de l'interrupteur Public/Privé
        const visibilityToggle = document.getElementById('toggle-visibility');
        const visibilityStatusText = document.getElementById('visibility-status-text');

        // Styles pour l'interrupteur (tailwind ne supporte pas l'accès direct aux pseudo-éléments 'checked')
        const updateToggleStyle = () => {
            // Mise à jour de la couleur de fond de la piste de l'interrupteur (label)
            const label = visibilityToggle.nextElementSibling;
            
            if (visibilityToggle.checked) {
                // Public (case cochée)
                label.style.backgroundColor = 'var(--primary-color)';
                visibilityStatusText.textContent = 'Public';
                visibilityStatusText.classList.add('text-primary-color-var');
                visibilityStatusText.classList.remove('text-warning-text-var'); // Si on avait un style d'alerte pour privé
            } else {
                // Privé (case non cochée)
                label.style.backgroundColor = 'var(--input-border)'; 
                visibilityStatusText.textContent = 'Privé';
                visibilityStatusText.classList.remove('text-primary-color-var');
            }
        };

        visibilityToggle.addEventListener('change', updateToggleStyle);

        // Au chargement initial (par défaut, il est non coché -> Privé)
        updateToggleStyle(); 

        // Gestion du déplacement du bouton de l'interrupteur
        // NOTE: Le style ci-dessous est nécessaire car Tailwind CSS ne gère pas directement le `:checked` + `+` (sibling) pour le style d'un toggle complex.
        const style = document.createElement('style');
        style.innerHTML = `
            .toggle-checkbox:checked {
                 background-color: var(--primary-color); 
            }
            .toggle-checkbox:checked + .toggle-label {
                background-color: var(--primary-color);
            }
            .toggle-checkbox:checked + .toggle-label:before {
                transform: translateX(100%);
            }
            .toggle-checkbox {
                opacity: 0;
            }
            .toggle-label {
                position: relative;
                height: 24px; 
                width: 48px;
                background-color: var(--input-border);
            }
            .toggle-label:before {
                content: '';
                position: absolute;
                top: 2px;
                left: 2px;
                width: 20px;
                height: 20px;
                border-radius: 9999px;
                background: white; /* Blanc pour le cercle, peu importe le thème */
                transition: transform 0.2s ease-in-out;
            }
        `;
        document.head.appendChild(style);

    </script>
</body>
</html>